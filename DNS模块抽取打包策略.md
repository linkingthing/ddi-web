# DNS模块抽取打包策略



### 背景

业务场景中需要在各个阶段可以将，现有开发完成的模块组合打包成一个可发布产品的需求，因此产生这个技术方案。

### 可实现思路

|实现方式|简要说明|优势|弊端|备注|
|-|-|-|-|-|
|webpack条件打包|通过定义全局变量控制加载以及渲染|只维护一份代码|需要在多个代码文件写判断逻辑|（使用）|
|新建仓库|copy现有代码重新建立仓库，独立维护|可以个性化处理两个系统|ui或者其他逻辑有调整时，会有双倍工作量||
|新建分支|在现有最新分支中拉去代码，并删除地址管理部分代码|同新建仓库|同新建仓库|


### webpack条件打包实现思路

1. 技术依赖
    - webpack.DefinePlugin是一个可在定义全局变量的
    - nodejs指令可自定义参数，可通过process.argv获取
2. 实现步骤
    - [x] 在 /config/index.js 内加入 PACK_SYSTEM，且设置默认值全量
    - [x] PACK_SYSTEM 通过 process.agrv获取
    - [x] 在package.json中定义带参数的启动脚本命令和打包脚本命令
    - [x] 在项目的菜单模块，路由模块使用 PACK_SYSTEM控制渲染和请求
    - [ ] 未使用的文件不加入 webpackmapping（暂未实现）tree shake试试
3. 扩展方法
    - 菜单组件和路由组件中拓展
4. 注意事项

### 使用方法

- 打包整体

```
npm run build
```

- 打包DNS系统

```
npm run buildDNS
```
